// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Home {
  id        Int               @id @default(autoincrement())
  name      String
  bills     ElectricityBill[]
  supplies  SupplyPoint[]
  waterBills WaterBill[]
  waterSupplies WaterSupplyPoint[]
}

model Provider {
  id        Int               @id @default(autoincrement())
  name      String
  bills     ElectricityBill[]
  taxId     String?
  market    String?
  address   String?
}

model SupplyPoint {
  id               Int               @id @default(autoincrement())
  homeId           Int
  cups             String
  distributor      String?
  accessContract   String?
  gridToll         String?
  addressLine      String?
  postalCode       String?
  city             String?
  region           String?
  country          String?
  contractedPowerP1 Decimal?
  contractedPowerP2 Decimal?
  meters           String?
  home             Home              @relation(fields: [homeId], references: [id])
  bills            ElectricityBill[]

  @@unique([cups])
}

model ElectricityBill {
  id             Int              @id @default(autoincrement())
  totalAmount    Decimal
  issueDate      DateTime
  paymentDate    DateTime?
  consumptionKwh Decimal
  pdfUrl         String?
  homeId         Int
  providerId     Int
  supplyPointId  Int?
  invoiceNumber  String?
  referenceNumber String?
  periodStart    DateTime?
  periodEnd      DateTime?
  periodDays     Int?
  tariff         String?
  contractNumber String?
  home           Home             @relation(fields: [homeId], references: [id])
  provider       Provider         @relation(fields: [providerId], references: [id])
  supplyPoint    SupplyPoint?     @relation(fields: [supplyPointId], references: [id])
  costLines      BillCostLine[]
}

model CostCategory {
  id        Int             @id @default(autoincrement())
  name      String
  lines     BillCostLine[]
}

model BillCostLine {
  id          Int             @id @default(autoincrement())
  billId      Int
  categoryId  Int
  amount      Decimal
  bill        ElectricityBill @relation(fields: [billId], references: [id])
  category    CostCategory    @relation(fields: [categoryId], references: [id])

  @@unique([billId, categoryId])
}

model WaterProvider {
  id      Int         @id @default(autoincrement())
  name    String
  taxId   String?
  address String?
  bills   WaterBill[]
}

model WaterSupplyPoint {
  id            Int         @id @default(autoincrement())
  homeId        Int
  contractNumber String?
  meterNumber   String?
  meterDiameterMm Int?
  supplyType    String?
  usage         String?
  addressLine   String?
  postalCode    String?
  city          String?
  region        String?
  country       String?
  home          Home        @relation(fields: [homeId], references: [id])
  bills         WaterBill[]
}

model WaterBill {
  id              Int                 @id @default(autoincrement())
  homeId          Int
  providerId      Int
  supplyPointId   Int?
  invoiceNumber   String?
  status          String?
  issueDate       DateTime
  dueDate         DateTime?
  paymentDate     DateTime?
  periodStart     DateTime?
  periodEnd       DateTime?
  periodType      String?
  totalAmount     Decimal
  consumptionM3   Decimal?
  averageDailyCost Decimal?
  pdfUrl          String?
  home            Home                @relation(fields: [homeId], references: [id])
  provider        WaterProvider       @relation(fields: [providerId], references: [id])
  supplyPoint     WaterSupplyPoint?   @relation(fields: [supplyPointId], references: [id])
  costLines       WaterBillCostLine[]
}

model WaterCostCategory {
  id    Int                @id @default(autoincrement())
  name  String
  lines WaterBillCostLine[]
}

model WaterBillCostLine {
  id         Int              @id @default(autoincrement())
  billId     Int
  categoryId Int
  amount     Decimal
  bill       WaterBill        @relation(fields: [billId], references: [id])
  category   WaterCostCategory @relation(fields: [categoryId], references: [id])

  @@unique([billId, categoryId])
}

model Vehicle {
  id           Int                 @id @default(autoincrement())
  name         String?
  brand        String
  model        String
  year         Int?
  licensePlate String?
  vin          String?
  notes        String?
  maintenances VehicleMaintenance[]

  @@unique([licensePlate])
  @@unique([vin])
}

model VehicleMaintenance {
  id          Int      @id @default(autoincrement())
  vehicleId   Int
  workshopId  Int?
  title       String
  description String?
  serviceDate DateTime
  odometerKm  Int?
  cost        Decimal?
  createdAt   DateTime @default(now())
  vehicle     Vehicle  @relation(fields: [vehicleId], references: [id])
  workshop    Workshop? @relation(fields: [workshopId], references: [id])
}

model Workshop {
  id            Int                 @id @default(autoincrement())
  name          String
  taxId         String?
  addressLine   String?
  postalCode    String?
  city          String?
  region        String?
  country       String?
  phone         String?
  email         String?
  notes         String?
  maintenances  VehicleMaintenance[]
}
