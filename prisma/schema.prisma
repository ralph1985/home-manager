// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Home {
  id        Int               @id @default(autoincrement())
  name      String
  bills     ElectricityBill[]
  supplies  SupplyPoint[]
}

model Provider {
  id        Int               @id @default(autoincrement())
  name      String
  bills     ElectricityBill[]
  taxId     String?
  market    String?
  address   String?
}

model SupplyPoint {
  id               Int               @id @default(autoincrement())
  homeId           Int
  cups             String
  distributor      String?
  accessContract   String?
  gridToll         String?
  addressLine      String?
  postalCode       String?
  city             String?
  region           String?
  country          String?
  contractedPowerP1 Decimal?
  contractedPowerP2 Decimal?
  meters           String?
  home             Home              @relation(fields: [homeId], references: [id])
  bills            ElectricityBill[]

  @@unique([cups])
}

model ElectricityBill {
  id             Int              @id @default(autoincrement())
  totalAmount    Decimal
  issueDate      DateTime
  paymentDate    DateTime?
  consumptionKwh Decimal
  pdfUrl         String?
  homeId         Int
  providerId     Int
  supplyPointId  Int?
  invoiceNumber  String?
  referenceNumber String?
  periodStart    DateTime?
  periodEnd      DateTime?
  periodDays     Int?
  tariff         String?
  contractNumber String?
  home           Home             @relation(fields: [homeId], references: [id])
  provider       Provider         @relation(fields: [providerId], references: [id])
  supplyPoint    SupplyPoint?     @relation(fields: [supplyPointId], references: [id])
  costLines      BillCostLine[]
}

model CostCategory {
  id        Int             @id @default(autoincrement())
  name      String
  lines     BillCostLine[]
}

model BillCostLine {
  id          Int             @id @default(autoincrement())
  billId      Int
  categoryId  Int
  amount      Decimal
  bill        ElectricityBill @relation(fields: [billId], references: [id])
  category    CostCategory    @relation(fields: [categoryId], references: [id])

  @@unique([billId, categoryId])
}
